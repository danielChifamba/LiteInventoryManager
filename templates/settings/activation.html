{% load static %}<!doctype html><html lang=en><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>License Management - POS System</title><link href="{% static" css/ext/bootstrap.min.css" %}" rel=stylesheet><div class="container-fluid py-4"><div class=row><div class=col-12><div class="d-flex justify-content-between align-items-center mb-4"><h1><i class="fas fa-key"></i> License Management</h1><div class=btn-group><button class="btn btn-primary" data-bs-toggle=modal data-bs-target=#generateLicenseModal>
<i class="fas fa-plus"></i> Generate License
</button>
<button class="btn btn-info" onclick=showLicenseInfo()>
<i class="fas fa-info-circle"></i> License Info</button></div></div></div></div><div class="row mb-4"><div class=col-12><div class=card><div class="card-header bg-primary text-white"><h5><i class="fas fa-certificate"></i> Current System License</h5></div><div class=card-body>{% if global_activation %}<div class=row><div class=col-md-6><table class="table table-borderless"><tr><td><strong>License Key:</strong><td><code>{{ global_activation.license_key }}</code><tr><td><strong>Type:</strong><td><span class="badge bg-{{ global_activation.license_type|license_color }}">{{ global_activation.get_license_type_display }}</span><tr><td><strong>Status:</strong><td>{% if global_activation.is_active %}
<span class="badge bg-success">Active</span>
{% else %}
<span class="badge bg-danger">Inactive</span>
{% endif %}<tr><td><strong>Expires:</strong><td>{{ global_activation.expiry_date|date:"M d, Y" }}
<small class=text-muted>({{ global_activation.days_until_expiry }} days remaining)</small></table></div><div class=col-md-6><h6>License Limits</h6>{% with limits=global_activation.check_limits %}<div class="progress-group mb-2"><label>Users: {{ limits.current_users }}/{{ global_activation.max_users }}</label><div class=progress><div class="progress-bar {% if limits.users_ok %}bg-success{% else %}bg-danger{% endif %}" style="width:{{ limits.current_users|div:global_activation.max_users|mul:100 }}%"></div></div></div><div class="progress-group mb-2"><label>Products: {{ limits.current_products }}/{{ global_activation.max_products }}</label><div class=progress><div class="progress-bar {% if limits.products_ok %}bg-success{% else %}bg-danger{% endif %}" style="width:{{ limits.current_products|div:global_activation.max_products|mul:100 }}%"></div></div></div><div class="progress-group mb-2"><label>Today's Transactions: {{ limits.daily_transactions }}/{{ global_activation.max_transactions_per_day }}</label><div class=progress><div class="progress-bar {% if limits.transactions_ok %}bg-success{% else %}bg-danger{% endif %}" style="width:{{ limits.daily_transactions|div:global_activation.max_transactions_per_day|mul:100 }}%"></div></div></div>{% endwith %}</div></div>{% else %}<div class="alert alert-warning"><i class="fas fa-exclamation-triangle"></i>
No active license found. Please activate your system.
<a href="{% url 'settings:activation' %}" class="btn btn-warning btn-sm ms-2">Activate Now</a></div>{% endif %}</div></div></div></div><div class=row><div class=col-12><div class=card><div class=card-header><h5><i class="fas fa-cogs"></i> License Generator</h5></div><div class=card-body><div class=row><div class=col-md-8><form id=licenseGeneratorForm method=post>{% csrf_token %}<div class=row><div class=col-md-4><div class=mb-3><label for=license_type class=form-label>License Type</label>
<select name=license_type id=license_type class=form-select required><option value=trial>Trial (14 days)<option value=lite>Lite (30 days)<option value=basic>Basic (1 year)<option value=professional>Professional (1 year)<option value=enterprise>Enterprise (3 years)</select></div></div><div class=col-md-4><div class=mb-3><label for=customer_name class=form-label>Customer Name</label>
<input name=customer_name id=customer_name class=form-control placeholder="Customer Name" required></div></div><div class=col-md-4><div class=mb-3><label for=customer_email class=form-label>Customer Email</label>
<input type=email name=customer_email id=customer_email class=form-control placeholder=customer@example.com required></div></div></div><div class=row><div class=col-md-6><div class=mb-3><label for=count class=form-label>Number of Licenses</label>
<input type=number name=count id=count class=form-control value=1 min=1 max=100></div></div><div class=col-md-6><div class=mb-3><label class=form-label>Export Options</label><div class=form-check><input type=checkbox name=export_csv id=export_csv class=form-check-input>
<label for=export_csv class=form-check-label>Export to CSV</label></div></div></div></div><button class="btn btn-success">
<i class="fas fa-key"></i> Generate License(s)</button></form></div><div class=col-md-4><div class="card bg-light"><div class=card-body><h6>License Types Comparison</h6><table class="table table-sm"><thead><tr><th>Type<th>Users<th>Products<th>Duration<tbody><tr><td><small>Trial</small><td><small>2</small><td><small>50</small><td><small>14 days</small><tr><td><small>Lite</small><td><small>3</small><td><small>500</small><td><small>30 days</small><tr><td><small>Basic</small><td><small>5</small><td><small>1,000</small><td><small>1 year</small><tr><td><small>Pro</small><td><small>15</small><td><small>5,000</small><td><small>1 year</small><tr><td><small>Enterprise</small><td><small>100</small><td><small>50,000</small><td><small>3 years</small></table></div></div></div></div></div></div></div></div><div class="row mt-4" id=generatedLicensesSection style=display:none><div class=col-12><div class=card><div class="card-header bg-success text-white"><h5><i class="fas fa-check"></i> Generated Licenses</h5></div><div class=card-body id=generatedLicensesContent></div></div></div></div></div><script src="{% static" utils/ext/bootstrap.bundle.min.js" %}"></script><script>document.getElementById("licenseGeneratorForm").addEventListener("submit",function(e){e.preventDefault();const n=new FormData(this),t=this.querySelector('button[type="submit"]'),s=t.innerHTML;t.innerHTML='<i class="fas fa-spinner fa-spin"></i> Generating...',t.disabled=!0,fetch('{% url "settings:generate_license" %}',{method:"POST",body:n,headers:{"X-CSRFToken":document.querySelector("[name=csrfmiddlewaretoken]").value}}).then(e=>e.json()).then(e=>{e.success?(displayGeneratedLicenses(e.licenses),showAlert("success",`Successfully generated ${e.licenses.length} license(s)!`)):showAlert("danger","Error generating licenses: "+e.error)}).catch(e=>{showAlert("danger","Network error: "+e.message)}).finally(()=>{t.innerHTML=s,t.disabled=!1})});function displayGeneratedLicenses(e){const n=document.getElementById("generatedLicensesContent"),s=document.getElementById("generatedLicensesSection");let t='<div class="table-responsive"><table class="table table-striped">';t+="<thead><tr><th>License Key</th><th>Type</th><th>Customer</th><th>Email</th><th>Validity</th><th>Actions</th></tr></thead><tbody>",e.forEach(e=>{t+=`
                    <tr>
                        <td><code>${e.license_key}</code></td>
                        <td><span class="badge bg-info">${e.license_type}</span></td>
                        <td>${e.contact_name}</td>
                        <td>${e.contact_email}</td>
                        <td>${e.validity_days} days</td>
                        <td>
                            <button class="btn btn-sm btn-outline-primary" onclick="copyToClipboard('${e.license_key}')">
                                <i class="fas fa-copy"></i> Copy
                            </button>
                        </td>
                    </tr>
                `}),t+="</tbody></table></div>",n.innerHTML=t,s.style.display="block"}function copyToClipboard(e){navigator.clipboard.writeText(e).then(()=>{showAlert("success","License key copied to clipboard!")})}function showAlert(e,t){const s=`
                <div class="alert alert-${e} alert-dismissible fade show" role="alert">
                    ${t}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            `,n=document.querySelector(".container-fluid");n.insertAdjacentHTML("afterbegin",s),setTimeout(()=>{const e=n.querySelector(".alert");e&&e.remove()},5e3)}</script>